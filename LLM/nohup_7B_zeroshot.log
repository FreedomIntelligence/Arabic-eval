nohup: ignoring input
[01:53:31] WARNING  The following values were not passed to `accelerate launch` and had defaults used instead:   launch.py:890
                            `--num_processes` was set to a value of `1`                                                       
                            `--num_machines` was set to a value of `1`                                                        
                            `--mixed_precision` was set to a value of `'no'`                                                  
                            `--dynamo_backend` was set to a value of `'no'`                                                   
                    To avoid this warning pass in values for each of the problematic parameters or run                        
                    `accelerate config`.                                                                                      
Using pad_token, but it is not set yet.
clinical_knowledge:   0%|                                                                            | 0/133 [00:00<?, ?it/s]clinical_knowledge:   1%|▌                                                                   | 1/133 [00:01<03:53,  1.77s/it]clinical_knowledge:   2%|█                                                                   | 2/133 [00:02<02:08,  1.02it/s]clinical_knowledge:   2%|█▌                                                                  | 3/133 [00:02<01:35,  1.36it/s]clinical_knowledge:   3%|██                                                                  | 4/133 [00:03<01:27,  1.48it/s]clinical_knowledge:   4%|██▌                                                                 | 5/133 [00:03<01:17,  1.64it/s]clinical_knowledge:   5%|███                                                                 | 6/133 [00:04<01:13,  1.74it/s]clinical_knowledge:   5%|███▌                                                                | 7/133 [00:04<01:08,  1.83it/s]clinical_knowledge:   6%|████                                                                | 8/133 [00:05<01:05,  1.90it/s]clinical_knowledge:   7%|████▌                                                               | 9/133 [00:05<01:02,  1.97it/s]clinical_knowledge:   8%|█████                                                              | 10/133 [00:06<01:01,  2.01it/s]clinical_knowledge:   8%|█████▌                                                             | 11/133 [00:06<01:00,  2.03it/s]clinical_knowledge:   9%|██████                                                             | 12/133 [00:06<00:54,  2.20it/s]clinical_knowledge:  10%|██████▌                                                            | 13/133 [00:07<00:47,  2.51it/s]clinical_knowledge:  11%|███████                                                            | 14/133 [00:07<00:43,  2.77it/s]clinical_knowledge:  11%|███████▌                                                           | 15/133 [00:07<00:39,  2.96it/s]clinical_knowledge:  12%|████████                                                           | 16/133 [00:08<00:37,  3.12it/s]clinical_knowledge:  13%|████████▌                                                          | 17/133 [00:08<00:35,  3.24it/s]clinical_knowledge:  14%|█████████                                                          | 18/133 [00:08<00:34,  3.36it/s]clinical_knowledge:  14%|█████████▌                                                         | 19/133 [00:08<00:33,  3.43it/s]clinical_knowledge:  15%|██████████                                                         | 20/133 [00:09<00:32,  3.48it/s]clinical_knowledge:  16%|██████████▌                                                        | 21/133 [00:09<00:32,  3.50it/s]clinical_knowledge:  17%|███████████                                                        | 22/133 [00:09<00:31,  3.52it/s]clinical_knowledge:  17%|███████████▌                                                       | 23/133 [00:10<00:30,  3.55it/s]clinical_knowledge:  18%|████████████                                                       | 24/133 [00:10<00:30,  3.58it/s]clinical_knowledge:  19%|████████████▌                                                      | 25/133 [00:10<00:29,  3.61it/s]clinical_knowledge:  20%|█████████████                                                      | 26/133 [00:10<00:29,  3.60it/s]clinical_knowledge:  20%|█████████████▌                                                     | 27/133 [00:11<00:29,  3.62it/s]clinical_knowledge:  21%|██████████████                                                     | 28/133 [00:11<00:28,  3.67it/s]clinical_knowledge:  22%|██████████████▌                                                    | 29/133 [00:11<00:28,  3.71it/s]clinical_knowledge:  23%|███████████████                                                    | 30/133 [00:11<00:28,  3.67it/s]clinical_knowledge:  23%|███████████████▌                                                   | 31/133 [00:12<00:28,  3.64it/s]clinical_knowledge:  24%|████████████████                                                   | 32/133 [00:12<00:27,  3.62it/s]clinical_knowledge:  25%|████████████████▌                                                  | 33/133 [00:12<00:27,  3.64it/s]clinical_knowledge:  26%|█████████████████▏                                                 | 34/133 [00:13<00:27,  3.62it/s]clinical_knowledge:  26%|█████████████████▋                                                 | 35/133 [00:13<00:27,  3.63it/s]clinical_knowledge:  27%|██████████████████▏                                                | 36/133 [00:13<00:26,  3.64it/s]clinical_knowledge:  28%|██████████████████▋                                                | 37/133 [00:13<00:26,  3.61it/s]clinical_knowledge:  29%|███████████████████▏                                               | 38/133 [00:14<00:26,  3.62it/s]clinical_knowledge:  29%|███████████████████▋                                               | 39/133 [00:14<00:26,  3.51it/s]clinical_knowledge:  30%|████████████████████▏                                              | 40/133 [00:14<00:25,  3.59it/s]clinical_knowledge:  31%|████████████████████▋                                              | 41/133 [00:15<00:25,  3.60it/s]clinical_knowledge:  32%|█████████████████████▏                                             | 42/133 [00:15<00:25,  3.62it/s]clinical_knowledge:  32%|█████████████████████▋                                             | 43/133 [00:15<00:25,  3.60it/s]clinical_knowledge:  33%|██████████████████████▏                                            | 44/133 [00:15<00:24,  3.62it/s]clinical_knowledge:  34%|██████████████████████▋                                            | 45/133 [00:16<00:24,  3.63it/s]clinical_knowledge:  35%|███████████████████████▏                                           | 46/133 [00:16<00:24,  3.57it/s]clinical_knowledge:  35%|███████████████████████▋                                           | 47/133 [00:16<00:24,  3.47it/s]clinical_knowledge:  36%|████████████████████████▏                                          | 48/133 [00:16<00:24,  3.46it/s]clinical_knowledge:  37%|████████████████████████▋                                          | 49/133 [00:17<00:24,  3.47it/s]clinical_knowledge:  38%|█████████████████████████▏                                         | 50/133 [00:17<00:23,  3.51it/s]clinical_knowledge:  38%|█████████████████████████▋                                         | 51/133 [00:17<00:22,  3.57it/s]clinical_knowledge:  39%|██████████████████████████▏                                        | 52/133 [00:18<00:22,  3.57it/s]clinical_knowledge:  40%|██████████████████████████▋                                        | 53/133 [00:18<00:22,  3.60it/s]clinical_knowledge:  41%|███████████████████████████▏                                       | 54/133 [00:18<00:21,  3.61it/s]clinical_knowledge:  41%|███████████████████████████▋                                       | 55/133 [00:18<00:22,  3.53it/s]clinical_knowledge:  42%|████████████████████████████▏                                      | 56/133 [00:19<00:22,  3.48it/s]clinical_knowledge:  43%|████████████████████████████▋                                      | 57/133 [00:19<00:21,  3.52it/s]clinical_knowledge:  44%|█████████████████████████████▏                                     | 58/133 [00:19<00:21,  3.54it/s]clinical_knowledge:  44%|█████████████████████████████▋                                     | 59/133 [00:20<00:20,  3.57it/s]clinical_knowledge:  45%|██████████████████████████████▏                                    | 60/133 [00:20<00:20,  3.57it/s]clinical_knowledge:  46%|██████████████████████████████▋                                    | 61/133 [00:20<00:19,  3.63it/s]clinical_knowledge:  47%|███████████████████████████████▏                                   | 62/133 [00:20<00:19,  3.63it/s]clinical_knowledge:  47%|███████████████████████████████▋                                   | 63/133 [00:21<00:19,  3.61it/s]clinical_knowledge:  48%|████████████████████████████████▏                                  | 64/133 [00:21<00:18,  3.66it/s]clinical_knowledge:  49%|████████████████████████████████▋                                  | 65/133 [00:21<00:18,  3.70it/s]clinical_knowledge:  50%|█████████████████████████████████▏                                 | 66/133 [00:22<00:18,  3.61it/s]clinical_knowledge:  50%|█████████████████████████████████▊                                 | 67/133 [00:22<00:18,  3.62it/s]clinical_knowledge:  51%|██████████████████████████████████▎                                | 68/133 [00:22<00:18,  3.61it/s]clinical_knowledge:  52%|██████████████████████████████████▊                                | 69/133 [00:22<00:17,  3.59it/s]clinical_knowledge:  53%|███████████████████████████████████▎                               | 70/133 [00:23<00:17,  3.59it/s]clinical_knowledge:  53%|███████████████████████████████████▊                               | 71/133 [00:23<00:17,  3.59it/s]clinical_knowledge:  54%|████████████████████████████████████▎                              | 72/133 [00:23<00:16,  3.60it/s]clinical_knowledge:  55%|████████████████████████████████████▊                              | 73/133 [00:23<00:16,  3.60it/s]clinical_knowledge:  56%|█████████████████████████████████████▎                             | 74/133 [00:24<00:16,  3.59it/s]clinical_knowledge:  56%|█████████████████████████████████████▊                             | 75/133 [00:24<00:16,  3.59it/s]clinical_knowledge:  57%|██████████████████████████████████████▎                            | 76/133 [00:24<00:16,  3.54it/s]clinical_knowledge:  58%|██████████████████████████████████████▊                            | 77/133 [00:25<00:15,  3.57it/s]clinical_knowledge:  59%|███████████████████████████████████████▎                           | 78/133 [00:25<00:15,  3.57it/s]clinical_knowledge:  59%|███████████████████████████████████████▊                           | 79/133 [00:25<00:15,  3.56it/s]clinical_knowledge:  60%|████████████████████████████████████████▎                          | 80/133 [00:25<00:15,  3.38it/s]clinical_knowledge:  61%|████████████████████████████████████████▊                          | 81/133 [00:26<00:15,  3.43it/s]clinical_knowledge:  62%|█████████████████████████████████████████▎                         | 82/133 [00:26<00:14,  3.46it/s]clinical_knowledge:  62%|█████████████████████████████████████████▊                         | 83/133 [00:26<00:14,  3.49it/s]clinical_knowledge:  63%|██████████████████████████████████████████▎                        | 84/133 [00:27<00:14,  3.43it/s]clinical_knowledge:  64%|██████████████████████████████████████████▊                        | 85/133 [00:27<00:13,  3.46it/s]clinical_knowledge:  65%|███████████████████████████████████████████▎                       | 86/133 [00:27<00:13,  3.49it/s]clinical_knowledge:  65%|███████████████████████████████████████████▊                       | 87/133 [00:27<00:13,  3.46it/s]clinical_knowledge:  66%|████████████████████████████████████████████▎                      | 88/133 [00:28<00:12,  3.50it/s]clinical_knowledge:  67%|████████████████████████████████████████████▊                      | 89/133 [00:28<00:12,  3.47it/s]clinical_knowledge:  68%|█████████████████████████████████████████████▎                     | 90/133 [00:28<00:12,  3.52it/s]clinical_knowledge:  68%|█████████████████████████████████████████████▊                     | 91/133 [00:29<00:11,  3.54it/s]clinical_knowledge:  69%|██████████████████████████████████████████████▎                    | 92/133 [00:29<00:11,  3.62it/s]clinical_knowledge:  70%|██████████████████████████████████████████████▊                    | 93/133 [00:29<00:11,  3.63it/s]clinical_knowledge:  71%|███████████████████████████████████████████████▎                   | 94/133 [00:29<00:10,  3.61it/s]clinical_knowledge:  71%|███████████████████████████████████████████████▊                   | 95/133 [00:30<00:10,  3.60it/s]clinical_knowledge:  72%|████████████████████████████████████████████████▎                  | 96/133 [00:30<00:10,  3.44it/s]clinical_knowledge:  73%|████████████████████████████████████████████████▊                  | 97/133 [00:30<00:10,  3.48it/s]clinical_knowledge:  74%|█████████████████████████████████████████████████▎                 | 98/133 [00:31<00:09,  3.54it/s]clinical_knowledge:  74%|█████████████████████████████████████████████████▊                 | 99/133 [00:31<00:09,  3.54it/s]clinical_knowledge:  75%|█████████████████████████████████████████████████▌                | 100/133 [00:31<00:09,  3.50it/s]clinical_knowledge:  76%|██████████████████████████████████████████████████                | 101/133 [00:31<00:09,  3.51it/s]clinical_knowledge:  77%|██████████████████████████████████████████████████▌               | 102/133 [00:32<00:08,  3.53it/s]clinical_knowledge:  77%|███████████████████████████████████████████████████               | 103/133 [00:32<00:08,  3.54it/s]clinical_knowledge:  78%|███████████████████████████████████████████████████▌              | 104/133 [00:32<00:08,  3.57it/s]clinical_knowledge:  79%|████████████████████████████████████████████████████              | 105/133 [00:33<00:08,  3.46it/s]clinical_knowledge:  80%|████████████████████████████████████████████████████▌             | 106/133 [00:33<00:07,  3.52it/s]clinical_knowledge:  80%|█████████████████████████████████████████████████████             | 107/133 [00:33<00:07,  3.53it/s]clinical_knowledge:  81%|█████████████████████████████████████████████████████▌            | 108/133 [00:33<00:07,  3.49it/s]clinical_knowledge:  82%|██████████████████████████████████████████████████████            | 109/133 [00:34<00:06,  3.54it/s]clinical_knowledge:  83%|██████████████████████████████████████████████████████▌           | 110/133 [00:34<00:06,  3.50it/s]clinical_knowledge:  83%|███████████████████████████████████████████████████████           | 111/133 [00:34<00:06,  3.52it/s]clinical_knowledge:  84%|███████████████████████████████████████████████████████▌          | 112/133 [00:35<00:05,  3.53it/s]clinical_knowledge:  85%|████████████████████████████████████████████████████████          | 113/133 [00:35<00:05,  3.48it/s]clinical_knowledge:  86%|████████████████████████████████████████████████████████▌         | 114/133 [00:35<00:05,  3.53it/s]clinical_knowledge:  86%|█████████████████████████████████████████████████████████         | 115/133 [00:35<00:05,  3.56it/s]clinical_knowledge:  87%|█████████████████████████████████████████████████████████▌        | 116/133 [00:36<00:04,  3.59it/s]clinical_knowledge:  88%|██████████████████████████████████████████████████████████        | 117/133 [00:36<00:04,  3.60it/s]clinical_knowledge:  89%|██████████████████████████████████████████████████████████▌       | 118/133 [00:36<00:04,  3.55it/s]clinical_knowledge:  89%|███████████████████████████████████████████████████████████       | 119/133 [00:36<00:03,  3.62it/s]clinical_knowledge:  90%|███████████████████████████████████████████████████████████▌      | 120/133 [00:37<00:03,  3.64it/s]clinical_knowledge:  91%|████████████████████████████████████████████████████████████      | 121/133 [00:37<00:03,  3.62it/s]clinical_knowledge:  92%|████████████████████████████████████████████████████████████▌     | 122/133 [00:37<00:03,  3.59it/s]clinical_knowledge:  92%|█████████████████████████████████████████████████████████████     | 123/133 [00:38<00:02,  3.57it/s]clinical_knowledge:  93%|█████████████████████████████████████████████████████████████▌    | 124/133 [00:38<00:02,  3.53it/s]clinical_knowledge:  94%|██████████████████████████████████████████████████████████████    | 125/133 [00:38<00:02,  3.56it/s]clinical_knowledge:  95%|██████████████████████████████████████████████████████████████▌   | 126/133 [00:38<00:01,  3.56it/s]clinical_knowledge:  95%|███████████████████████████████████████████████████████████████   | 127/133 [00:39<00:01,  3.59it/s]clinical_knowledge:  96%|███████████████████████████████████████████████████████████████▌  | 128/133 [00:39<00:01,  3.59it/s]clinical_knowledge:  97%|████████████████████████████████████████████████████████████████  | 129/133 [00:39<00:01,  3.60it/s]clinical_knowledge:  98%|████████████████████████████████████████████████████████████████▌ | 130/133 [00:40<00:00,  3.54it/s]clinical_knowledge:  98%|█████████████████████████████████████████████████████████████████ | 131/133 [00:40<00:00,  3.57it/s]clinical_knowledge:  99%|█████████████████████████████████████████████████████████████████▌| 132/133 [00:40<00:00,  3.60it/s]clinical_knowledge: 100%|██████████████████████████████████████████████████████████████████| 133/133 [00:40<00:00,  3.69it/s]clinical_knowledge: 100%|██████████████████████████████████████████████████████████████████| 133/133 [00:40<00:00,  3.25it/s]
╭─────────────────────────────── Traceback (most recent call last) ────────────────────────────────╮
│ /home/yufei/arabic/LLM-eval-pipeline/eval.py:25 in <module>                                      │
│                                                                                                  │
│   22 │   │   │   │   │     setting=args.setting,                                                 │
│   23 │   │   │   │   │     n_shot=args.n_shot,                                                   │
│   24 │   │   │   │   │     accelerator=accelerator)                                              │
│ ❱ 25 │   Eval.evaluate()                                                                         │
│   26                                                                                             │
│   27                                                                                             │
│   28                                                                                             │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:219 in evaluate                │
│                                                                                                  │
│   216 │   def evaluate(self):                                                                    │
│   217 │   │   all_datasets = self.benchmark.get_datasets(self.setting, self.n_shot)              │
│   218 │   │   lens = self._count_examples(all_datasets)                                          │
│ ❱ 219 │   │   metrics = self._eval_datasets(all_datasets, save_responses=True)                   │
│   220 │   │   aggr_metrics = self._aggregate_metrics(metrics, lens)                              │
│   221 │   │   if self.accelerator.is_main_process:                                               │
│   222 │   │   │   self.save_aggr_metrics(aggr_metrics)                                           │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:211 in _eval_datasets          │
│                                                                                                  │
│   208 │   │   │   │   │   │   }                                                                  │
│   209 │   │   │   │   }                                                                          │
│   210 │   │   """                                                                                │
│ ❱ 211 │   │   return {                                                                           │
│   212 │   │   │   task_name: self._eval_task(task_name, all_datasets[task_name], save_response   │
│   213 │   │   │   for task_name in all_datasets.keys()                                           │
│   214 │   │   }                                                                                  │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:212 in <dictcomp>              │
│                                                                                                  │
│   209 │   │   │   │   }                                                                          │
│   210 │   │   """                                                                                │
│   211 │   │   return {                                                                           │
│ ❱ 212 │   │   │   task_name: self._eval_task(task_name, all_datasets[task_name], save_response   │
│   213 │   │   │   for task_name in all_datasets.keys()                                           │
│   214 │   │   }                                                                                  │
│   215                                                                                            │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:188 in _eval_task              │
│                                                                                                  │
│   185 │   │                                                                                      │
│   186 │   │   samples = self._zip_qra(dataset, response_list, response_answer_list)              │
│   187 │   │   if save_responses and self.accelerator.is_main_process:                            │
│ ❱ 188 │   │   │   self.save_response(samples, task_name)                                         │
│   189 │   │                                                                                      │
│   190 │   │   metrics = self._compute_metrics(samples, task_name)                                │
│   191 │   │   self.accelerator.print(metrics)                                                    │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:140 in save_response           │
│                                                                                                  │
│   137 │   │                                                                                      │
│   138 │   │   save_file = os.path.join(self.model_results_dir, f'{task_name}.jsonl')             │
│   139 │   │   os.makedirs(os.path.dirname(save_file), exist_ok=True)                             │
│ ❱ 140 │   │   with open(save_file, 'w', encoding='utf-8') as f:                                  │
│   141 │   │   │   f.writelines([json.dumps(sample, ensure_ascii=False) + '\n'  for sample in s   │
│   142 │   │   print(f'Save responses to {save_file}')                                            │
│   143                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────╯
PermissionError: [Errno 13] Permission denied: 
'benchmark_eval/results/zero_shot/MMLUArabic/llama-raw-pretrained-sencondround-ckpt0-430000/clinical_knowledge.jsonl'
╭─────────────────────────────── Traceback (most recent call last) ────────────────────────────────╮
│ /mntcephfs/data/med/miniconda3/envs/steven/bin/accelerate:8 in <module>                          │
│                                                                                                  │
│   5 from accelerate.commands.accelerate_cli import main                                          │
│   6 if __name__ == '__main__':                                                                   │
│   7 │   sys.argv[0] = re.sub(r'(-script\.pyw|\.exe)?$', '', sys.argv[0])                         │
│ ❱ 8 │   sys.exit(main())                                                                         │
│   9                                                                                              │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/accelerate_cli.py:45 in main  │
│                                                                                                  │
│   42 │   │   exit(1)                                                                             │
│   43 │                                                                                           │
│   44 │   # Run                                                                                   │
│ ❱ 45 │   args.func(args)                                                                         │
│   46                                                                                             │
│   47                                                                                             │
│   48 if __name__ == "__main__":                                                                  │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/launch.py:918 in              │
│ launch_command                                                                                   │
│                                                                                                  │
│   915 │   elif defaults is not None and defaults.compute_environment == ComputeEnvironment.AMA   │
│   916 │   │   sagemaker_launcher(defaults, args)                                                 │
│   917 │   else:                                                                                  │
│ ❱ 918 │   │   simple_launcher(args)                                                              │
│   919                                                                                            │
│   920                                                                                            │
│   921 def main():                                                                                │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/launch.py:580 in              │
│ simple_launcher                                                                                  │
│                                                                                                  │
│   577 │   process.wait()                                                                         │
│   578 │   if process.returncode != 0:                                                            │
│   579 │   │   if not args.quiet:                                                                 │
│ ❱ 580 │   │   │   raise subprocess.CalledProcessError(returncode=process.returncode, cmd=cmd)    │
│   581 │   │   else:                                                                              │
│   582 │   │   │   sys.exit(1)                                                                    │
│   583                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────╯
CalledProcessError: Command '['/mntcephfs/data/med/miniconda3/envs/steven/bin/python', 'eval.py', '--model_id', 
'llama-raw-pretrained-sencondround-ckpt0-430000', '--batch_size', '2', '--benchmark_name', 'MMLUArabic', '--setting', 
'zero_shot', '--generation_type', 'MMLU']' returned non-zero exit status 1.
[01:54:40] WARNING  The following values were not passed to `accelerate launch` and had defaults used instead:   launch.py:890
                            `--num_processes` was set to a value of `1`                                                       
                            `--num_machines` was set to a value of `1`                                                        
                            `--mixed_precision` was set to a value of `'no'`                                                  
                            `--dynamo_backend` was set to a value of `'no'`                                                   
                    To avoid this warning pass in values for each of the problematic parameters or run                        
                    `accelerate config`.                                                                                      
Using pad_token, but it is not set yet.
clinical_knowledge:   0%|                                                                            | 0/133 [00:00<?, ?it/s]clinical_knowledge:   1%|▌                                                                   | 1/133 [00:01<04:22,  1.99s/it]clinical_knowledge:   2%|█                                                                   | 2/133 [00:02<02:20,  1.07s/it]clinical_knowledge:   2%|█▌                                                                  | 3/133 [00:02<01:43,  1.25it/s]clinical_knowledge:   3%|██                                                                  | 4/133 [00:03<01:25,  1.51it/s]clinical_knowledge:   4%|██▌                                                                 | 5/133 [00:03<01:17,  1.66it/s]clinical_knowledge:   5%|███                                                                 | 6/133 [00:04<01:12,  1.75it/s]clinical_knowledge:   5%|███▌                                                                | 7/133 [00:04<01:08,  1.83it/s]clinical_knowledge:   6%|████                                                                | 8/133 [00:05<01:06,  1.89it/s]clinical_knowledge:   7%|████▌                                                               | 9/133 [00:05<01:03,  1.96it/s]clinical_knowledge:   8%|█████                                                              | 10/133 [00:06<01:02,  1.98it/s]clinical_knowledge:   8%|█████▌                                                             | 11/133 [00:06<01:01,  2.00it/s]clinical_knowledge:   9%|██████                                                             | 12/133 [00:07<01:00,  1.99it/s]clinical_knowledge:  10%|██████▌                                                            | 13/133 [00:07<00:57,  2.08it/s]clinical_knowledge:  11%|███████                                                            | 14/133 [00:08<00:56,  2.12it/s]clinical_knowledge:  11%|███████▌                                                           | 15/133 [00:08<00:56,  2.09it/s]clinical_knowledge:  12%|████████                                                           | 16/133 [00:09<00:55,  2.11it/s]clinical_knowledge:  13%|████████▌                                                          | 17/133 [00:09<00:54,  2.11it/s]clinical_knowledge:  14%|█████████                                                          | 18/133 [00:10<00:53,  2.14it/s]clinical_knowledge:  14%|█████████▌                                                         | 19/133 [00:10<00:52,  2.16it/s]clinical_knowledge:  15%|██████████                                                         | 20/133 [00:10<00:52,  2.17it/s]clinical_knowledge:  16%|██████████▌                                                        | 21/133 [00:11<00:51,  2.16it/s]clinical_knowledge:  17%|███████████                                                        | 22/133 [00:11<00:51,  2.14it/s]clinical_knowledge:  17%|███████████▌                                                       | 23/133 [00:12<00:50,  2.16it/s]clinical_knowledge:  18%|████████████                                                       | 24/133 [00:12<00:49,  2.21it/s]clinical_knowledge:  19%|████████████▌                                                      | 25/133 [00:13<00:48,  2.24it/s]clinical_knowledge:  20%|█████████████                                                      | 26/133 [00:13<00:48,  2.21it/s]clinical_knowledge:  20%|█████████████▌                                                     | 27/133 [00:14<00:47,  2.23it/s]clinical_knowledge:  21%|██████████████                                                     | 28/133 [00:14<00:45,  2.30it/s]clinical_knowledge:  22%|██████████████▌                                                    | 29/133 [00:14<00:44,  2.32it/s]clinical_knowledge:  23%|███████████████                                                    | 30/133 [00:15<00:45,  2.26it/s]clinical_knowledge:  23%|███████████████▌                                                   | 31/133 [00:15<00:45,  2.22it/s]clinical_knowledge:  24%|████████████████                                                   | 32/133 [00:16<00:45,  2.22it/s]clinical_knowledge:  25%|████████████████▌                                                  | 33/133 [00:16<00:44,  2.24it/s]clinical_knowledge:  26%|█████████████████▏                                                 | 34/133 [00:17<00:44,  2.21it/s]clinical_knowledge:  26%|█████████████████▋                                                 | 35/133 [00:17<00:43,  2.23it/s]clinical_knowledge:  27%|██████████████████▏                                                | 36/133 [00:18<00:43,  2.24it/s]clinical_knowledge:  28%|██████████████████▋                                                | 37/133 [00:18<00:43,  2.20it/s]clinical_knowledge:  29%|███████████████████▏                                               | 38/133 [00:19<00:42,  2.22it/s]clinical_knowledge:  29%|███████████████████▋                                               | 39/133 [00:19<00:44,  2.11it/s]clinical_knowledge:  30%|████████████████████▏                                              | 40/133 [00:19<00:42,  2.20it/s]clinical_knowledge:  31%|████████████████████▋                                              | 41/133 [00:20<00:41,  2.21it/s]clinical_knowledge:  32%|█████████████████████▏                                             | 42/133 [00:20<00:40,  2.23it/s]clinical_knowledge:  32%|█████████████████████▋                                             | 43/133 [00:21<00:40,  2.20it/s]clinical_knowledge:  33%|██████████████████████▏                                            | 44/133 [00:21<00:39,  2.25it/s]clinical_knowledge:  34%|██████████████████████▋                                            | 45/133 [00:22<00:38,  2.26it/s]clinical_knowledge:  35%|███████████████████████▏                                           | 46/133 [00:22<00:39,  2.18it/s]clinical_knowledge:  35%|███████████████████████▋                                           | 47/133 [00:23<00:40,  2.14it/s]clinical_knowledge:  36%|████████████████████████▏                                          | 48/133 [00:23<00:39,  2.15it/s]clinical_knowledge:  37%|████████████████████████▋                                          | 49/133 [00:24<00:38,  2.20it/s]clinical_knowledge:  38%|█████████████████████████▏                                         | 50/133 [00:24<00:37,  2.23it/s]clinical_knowledge:  38%|█████████████████████████▋                                         | 51/133 [00:24<00:35,  2.31it/s]clinical_knowledge:  39%|██████████████████████████▏                                        | 52/133 [00:25<00:35,  2.28it/s]clinical_knowledge:  40%|██████████████████████████▋                                        | 53/133 [00:25<00:35,  2.28it/s]clinical_knowledge:  41%|███████████████████████████▏                                       | 54/133 [00:26<00:34,  2.27it/s]clinical_knowledge:  41%|███████████████████████████▋                                       | 55/133 [00:26<00:35,  2.17it/s]clinical_knowledge:  42%|████████████████████████████▏                                      | 56/133 [00:27<00:36,  2.09it/s]clinical_knowledge:  43%|████████████████████████████▋                                      | 57/133 [00:27<00:35,  2.13it/s]clinical_knowledge:  44%|█████████████████████████████▏                                     | 58/133 [00:28<00:34,  2.15it/s]clinical_knowledge:  44%|█████████████████████████████▋                                     | 59/133 [00:28<00:33,  2.19it/s]clinical_knowledge:  45%|██████████████████████████████▏                                    | 60/133 [00:29<00:33,  2.18it/s]clinical_knowledge:  46%|██████████████████████████████▋                                    | 61/133 [00:29<00:32,  2.25it/s]clinical_knowledge:  47%|███████████████████████████████▏                                   | 62/133 [00:29<00:31,  2.25it/s]clinical_knowledge:  47%|███████████████████████████████▋                                   | 63/133 [00:30<00:31,  2.22it/s]clinical_knowledge:  48%|████████████████████████████████▏                                  | 64/133 [00:30<00:30,  2.30it/s]clinical_knowledge:  49%|████████████████████████████████▋                                  | 65/133 [00:31<00:29,  2.33it/s]clinical_knowledge:  50%|█████████████████████████████████▏                                 | 66/133 [00:31<00:30,  2.23it/s]clinical_knowledge:  50%|█████████████████████████████████▊                                 | 67/133 [00:32<00:29,  2.24it/s]clinical_knowledge:  51%|██████████████████████████████████▎                                | 68/133 [00:32<00:29,  2.20it/s]clinical_knowledge:  52%|██████████████████████████████████▊                                | 69/133 [00:33<00:29,  2.16it/s]clinical_knowledge:  53%|███████████████████████████████████▎                               | 70/133 [00:33<00:29,  2.17it/s]clinical_knowledge:  53%|███████████████████████████████████▊                               | 71/133 [00:34<00:28,  2.17it/s]clinical_knowledge:  54%|████████████████████████████████████▎                              | 72/133 [00:34<00:27,  2.20it/s]clinical_knowledge:  55%|████████████████████████████████████▊                              | 73/133 [00:34<00:27,  2.20it/s]clinical_knowledge:  56%|█████████████████████████████████████▎                             | 74/133 [00:35<00:26,  2.19it/s]clinical_knowledge:  56%|█████████████████████████████████████▊                             | 75/133 [00:35<00:26,  2.19it/s]clinical_knowledge:  57%|██████████████████████████████████████▎                            | 76/133 [00:36<00:26,  2.15it/s]clinical_knowledge:  58%|██████████████████████████████████████▊                            | 77/133 [00:36<00:25,  2.19it/s]clinical_knowledge:  59%|███████████████████████████████████████▎                           | 78/133 [00:37<00:25,  2.18it/s]clinical_knowledge:  59%|███████████████████████████████████████▊                           | 79/133 [00:37<00:25,  2.15it/s]clinical_knowledge:  60%|████████████████████████████████████████▎                          | 80/133 [00:38<00:27,  1.95it/s]clinical_knowledge:  61%|████████████████████████████████████████▊                          | 81/133 [00:38<00:25,  2.01it/s]clinical_knowledge:  62%|█████████████████████████████████████████▎                         | 82/133 [00:39<00:24,  2.06it/s]clinical_knowledge:  62%|█████████████████████████████████████████▊                         | 83/133 [00:39<00:24,  2.08it/s]clinical_knowledge:  63%|██████████████████████████████████████████▎                        | 84/133 [00:40<00:24,  2.02it/s]clinical_knowledge:  64%|██████████████████████████████████████████▊                        | 85/133 [00:40<00:23,  2.05it/s]clinical_knowledge:  65%|███████████████████████████████████████████▎                       | 86/133 [00:41<00:22,  2.07it/s]clinical_knowledge:  65%|███████████████████████████████████████████▊                       | 87/133 [00:41<00:22,  2.06it/s]clinical_knowledge:  66%|████████████████████████████████████████████▎                      | 88/133 [00:42<00:21,  2.10it/s]clinical_knowledge:  67%|████████████████████████████████████████████▊                      | 89/133 [00:42<00:21,  2.06it/s]clinical_knowledge:  68%|█████████████████████████████████████████████▎                     | 90/133 [00:43<00:20,  2.13it/s]clinical_knowledge:  68%|█████████████████████████████████████████████▊                     | 91/133 [00:43<00:19,  2.13it/s]clinical_knowledge:  69%|██████████████████████████████████████████████▎                    | 92/133 [00:43<00:18,  2.23it/s]clinical_knowledge:  70%|██████████████████████████████████████████████▊                    | 93/133 [00:44<00:17,  2.25it/s]clinical_knowledge:  71%|███████████████████████████████████████████████▎                   | 94/133 [00:44<00:17,  2.23it/s]clinical_knowledge:  71%|███████████████████████████████████████████████▊                   | 95/133 [00:45<00:17,  2.21it/s]clinical_knowledge:  72%|████████████████████████████████████████████████▎                  | 96/133 [00:45<00:18,  2.02it/s]clinical_knowledge:  73%|████████████████████████████████████████████████▊                  | 97/133 [00:46<00:17,  2.08it/s]clinical_knowledge:  74%|█████████████████████████████████████████████████▎                 | 98/133 [00:46<00:16,  2.13it/s]clinical_knowledge:  74%|█████████████████████████████████████████████████▊                 | 99/133 [00:47<00:15,  2.14it/s]clinical_knowledge:  75%|█████████████████████████████████████████████████▌                | 100/133 [00:47<00:15,  2.10it/s]clinical_knowledge:  76%|██████████████████████████████████████████████████                | 101/133 [00:48<00:14,  2.13it/s]clinical_knowledge:  77%|██████████████████████████████████████████████████▌               | 102/133 [00:48<00:14,  2.13it/s]clinical_knowledge:  77%|███████████████████████████████████████████████████               | 103/133 [00:49<00:14,  2.13it/s]clinical_knowledge:  78%|███████████████████████████████████████████████████▌              | 104/133 [00:49<00:13,  2.17it/s]clinical_knowledge:  79%|████████████████████████████████████████████████████              | 105/133 [00:50<00:13,  2.06it/s]clinical_knowledge:  80%|████████████████████████████████████████████████████▌             | 106/133 [00:50<00:12,  2.12it/s]clinical_knowledge:  80%|█████████████████████████████████████████████████████             | 107/133 [00:51<00:12,  2.14it/s]clinical_knowledge:  81%|█████████████████████████████████████████████████████▌            | 108/133 [00:51<00:11,  2.10it/s]clinical_knowledge:  82%|██████████████████████████████████████████████████████            | 109/133 [00:51<00:11,  2.14it/s]clinical_knowledge:  83%|██████████████████████████████████████████████████████▌           | 110/133 [00:52<00:10,  2.11it/s]clinical_knowledge:  83%|███████████████████████████████████████████████████████           | 111/133 [00:52<00:10,  2.14it/s]clinical_knowledge:  84%|███████████████████████████████████████████████████████▌          | 112/133 [00:53<00:09,  2.12it/s]clinical_knowledge:  85%|████████████████████████████████████████████████████████          | 113/133 [00:53<00:09,  2.07it/s]clinical_knowledge:  86%|████████████████████████████████████████████████████████▌         | 114/133 [00:54<00:09,  2.11it/s]clinical_knowledge:  86%|█████████████████████████████████████████████████████████         | 115/133 [00:54<00:08,  2.15it/s]clinical_knowledge:  87%|█████████████████████████████████████████████████████████▌        | 116/133 [00:55<00:07,  2.20it/s]clinical_knowledge:  88%|██████████████████████████████████████████████████████████        | 117/133 [00:55<00:07,  2.22it/s]clinical_knowledge:  89%|██████████████████████████████████████████████████████████▌       | 118/133 [00:56<00:06,  2.17it/s]clinical_knowledge:  89%|███████████████████████████████████████████████████████████       | 119/133 [00:56<00:06,  2.24it/s]clinical_knowledge:  90%|███████████████████████████████████████████████████████████▌      | 120/133 [00:56<00:05,  2.27it/s]clinical_knowledge:  91%|████████████████████████████████████████████████████████████      | 121/133 [00:57<00:05,  2.22it/s]clinical_knowledge:  92%|████████████████████████████████████████████████████████████▌     | 122/133 [00:57<00:04,  2.21it/s]clinical_knowledge:  92%|█████████████████████████████████████████████████████████████     | 123/133 [00:58<00:04,  2.19it/s]clinical_knowledge:  93%|█████████████████████████████████████████████████████████████▌    | 124/133 [00:58<00:04,  2.14it/s]clinical_knowledge:  94%|██████████████████████████████████████████████████████████████    | 125/133 [00:59<00:03,  2.17it/s]clinical_knowledge:  95%|██████████████████████████████████████████████████████████████▌   | 126/133 [00:59<00:03,  2.16it/s]clinical_knowledge:  95%|███████████████████████████████████████████████████████████████   | 127/133 [01:00<00:02,  2.20it/s]clinical_knowledge:  96%|███████████████████████████████████████████████████████████████▌  | 128/133 [01:00<00:02,  2.19it/s]clinical_knowledge:  97%|████████████████████████████████████████████████████████████████  | 129/133 [01:01<00:01,  2.20it/s]clinical_knowledge:  98%|████████████████████████████████████████████████████████████████▌ | 130/133 [01:01<00:01,  2.11it/s]clinical_knowledge:  98%|█████████████████████████████████████████████████████████████████ | 131/133 [01:02<00:00,  2.14it/s]clinical_knowledge:  99%|█████████████████████████████████████████████████████████████████▌| 132/133 [01:02<00:00,  2.20it/s]clinical_knowledge: 100%|██████████████████████████████████████████████████████████████████| 133/133 [01:02<00:00,  2.45it/s]clinical_knowledge: 100%|██████████████████████████████████████████████████████████████████| 133/133 [01:02<00:00,  2.12it/s]
╭─────────────────────────────── Traceback (most recent call last) ────────────────────────────────╮
│ /home/yufei/arabic/LLM-eval-pipeline/eval.py:25 in <module>                                      │
│                                                                                                  │
│   22 │   │   │   │   │     setting=args.setting,                                                 │
│   23 │   │   │   │   │     n_shot=args.n_shot,                                                   │
│   24 │   │   │   │   │     accelerator=accelerator)                                              │
│ ❱ 25 │   Eval.evaluate()                                                                         │
│   26                                                                                             │
│   27                                                                                             │
│   28                                                                                             │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:219 in evaluate                │
│                                                                                                  │
│   216 │   def evaluate(self):                                                                    │
│   217 │   │   all_datasets = self.benchmark.get_datasets(self.setting, self.n_shot)              │
│   218 │   │   lens = self._count_examples(all_datasets)                                          │
│ ❱ 219 │   │   metrics = self._eval_datasets(all_datasets, save_responses=True)                   │
│   220 │   │   aggr_metrics = self._aggregate_metrics(metrics, lens)                              │
│   221 │   │   if self.accelerator.is_main_process:                                               │
│   222 │   │   │   self.save_aggr_metrics(aggr_metrics)                                           │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:211 in _eval_datasets          │
│                                                                                                  │
│   208 │   │   │   │   │   │   }                                                                  │
│   209 │   │   │   │   }                                                                          │
│   210 │   │   """                                                                                │
│ ❱ 211 │   │   return {                                                                           │
│   212 │   │   │   task_name: self._eval_task(task_name, all_datasets[task_name], save_response   │
│   213 │   │   │   for task_name in all_datasets.keys()                                           │
│   214 │   │   }                                                                                  │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:212 in <dictcomp>              │
│                                                                                                  │
│   209 │   │   │   │   }                                                                          │
│   210 │   │   """                                                                                │
│   211 │   │   return {                                                                           │
│ ❱ 212 │   │   │   task_name: self._eval_task(task_name, all_datasets[task_name], save_response   │
│   213 │   │   │   for task_name in all_datasets.keys()                                           │
│   214 │   │   }                                                                                  │
│   215                                                                                            │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:188 in _eval_task              │
│                                                                                                  │
│   185 │   │                                                                                      │
│   186 │   │   samples = self._zip_qra(dataset, response_list, response_answer_list)              │
│   187 │   │   if save_responses and self.accelerator.is_main_process:                            │
│ ❱ 188 │   │   │   self.save_response(samples, task_name)                                         │
│   189 │   │                                                                                      │
│   190 │   │   metrics = self._compute_metrics(samples, task_name)                                │
│   191 │   │   self.accelerator.print(metrics)                                                    │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:140 in save_response           │
│                                                                                                  │
│   137 │   │                                                                                      │
│   138 │   │   save_file = os.path.join(self.model_results_dir, f'{task_name}.jsonl')             │
│   139 │   │   os.makedirs(os.path.dirname(save_file), exist_ok=True)                             │
│ ❱ 140 │   │   with open(save_file, 'w', encoding='utf-8') as f:                                  │
│   141 │   │   │   f.writelines([json.dumps(sample, ensure_ascii=False) + '\n'  for sample in s   │
│   142 │   │   print(f'Save responses to {save_file}')                                            │
│   143                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────╯
PermissionError: [Errno 13] Permission denied: 
'benchmark_eval/results/zero_shot/MMLUArabic/llama-raw-pretrained-ckpt0-227566/clinical_knowledge.jsonl'
╭─────────────────────────────── Traceback (most recent call last) ────────────────────────────────╮
│ /mntcephfs/data/med/miniconda3/envs/steven/bin/accelerate:8 in <module>                          │
│                                                                                                  │
│   5 from accelerate.commands.accelerate_cli import main                                          │
│   6 if __name__ == '__main__':                                                                   │
│   7 │   sys.argv[0] = re.sub(r'(-script\.pyw|\.exe)?$', '', sys.argv[0])                         │
│ ❱ 8 │   sys.exit(main())                                                                         │
│   9                                                                                              │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/accelerate_cli.py:45 in main  │
│                                                                                                  │
│   42 │   │   exit(1)                                                                             │
│   43 │                                                                                           │
│   44 │   # Run                                                                                   │
│ ❱ 45 │   args.func(args)                                                                         │
│   46                                                                                             │
│   47                                                                                             │
│   48 if __name__ == "__main__":                                                                  │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/launch.py:918 in              │
│ launch_command                                                                                   │
│                                                                                                  │
│   915 │   elif defaults is not None and defaults.compute_environment == ComputeEnvironment.AMA   │
│   916 │   │   sagemaker_launcher(defaults, args)                                                 │
│   917 │   else:                                                                                  │
│ ❱ 918 │   │   simple_launcher(args)                                                              │
│   919                                                                                            │
│   920                                                                                            │
│   921 def main():                                                                                │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/launch.py:580 in              │
│ simple_launcher                                                                                  │
│                                                                                                  │
│   577 │   process.wait()                                                                         │
│   578 │   if process.returncode != 0:                                                            │
│   579 │   │   if not args.quiet:                                                                 │
│ ❱ 580 │   │   │   raise subprocess.CalledProcessError(returncode=process.returncode, cmd=cmd)    │
│   581 │   │   else:                                                                              │
│   582 │   │   │   sys.exit(1)                                                                    │
│   583                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────╯
CalledProcessError: Command '['/mntcephfs/data/med/miniconda3/envs/steven/bin/python', 'eval.py', '--model_id', 
'llama-raw-pretrained-ckpt0-227566', '--batch_size', '2', '--benchmark_name', 'MMLUArabic', '--setting', 'zero_shot', 
'--generation_type', 'MMLU']' returned non-zero exit status 1.
[01:56:09] WARNING  The following values were not passed to `accelerate launch` and had defaults used instead:   launch.py:890
                            `--num_processes` was set to a value of `1`                                                       
                            `--num_machines` was set to a value of `1`                                                        
                            `--mixed_precision` was set to a value of `'no'`                                                  
                            `--dynamo_backend` was set to a value of `'no'`                                                   
                    To avoid this warning pass in values for each of the problematic parameters or run                        
                    `accelerate config`.                                                                                      
Loading checkpoint shards:   0%|                                                                       | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|███████████████████████████████▌                               | 1/2 [00:00<00:00,  7.13it/s]Loading checkpoint shards: 100%|███████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  7.53it/s]Loading checkpoint shards: 100%|███████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  7.46it/s]
Using pad_token, but it is not set yet.
clinical_knowledge:   0%|                                                                            | 0/133 [00:00<?, ?it/s]clinical_knowledge:   1%|▌                                                                   | 1/133 [00:01<02:12,  1.00s/it]clinical_knowledge:   2%|█                                                                   | 2/133 [00:01<01:15,  1.74it/s]clinical_knowledge:   2%|█▌                                                                  | 3/133 [00:01<00:56,  2.28it/s]clinical_knowledge:   3%|██                                                                  | 4/133 [00:01<00:48,  2.65it/s]clinical_knowledge:   4%|██▌                                                                 | 5/133 [00:02<00:44,  2.87it/s]clinical_knowledge:   5%|███                                                                 | 6/133 [00:02<00:42,  3.01it/s]clinical_knowledge:   5%|███▌                                                                | 7/133 [00:02<00:40,  3.14it/s]clinical_knowledge:   6%|████                                                                | 8/133 [00:03<00:38,  3.23it/s]clinical_knowledge:   7%|████▌                                                               | 9/133 [00:03<00:38,  3.24it/s]clinical_knowledge:   8%|█████                                                              | 10/133 [00:03<00:38,  3.24it/s]clinical_knowledge:   8%|█████▌                                                             | 11/133 [00:03<00:37,  3.25it/s]clinical_knowledge:   9%|██████                                                             | 12/133 [00:04<00:37,  3.23it/s]clinical_knowledge:  10%|██████▌                                                            | 13/133 [00:04<00:35,  3.36it/s]clinical_knowledge:  11%|███████                                                            | 14/133 [00:04<00:34,  3.43it/s]clinical_knowledge:  11%|███████▌                                                           | 15/133 [00:05<00:34,  3.46it/s]clinical_knowledge:  12%|████████                                                           | 16/133 [00:05<00:33,  3.50it/s]clinical_knowledge:  13%|████████▌                                                          | 17/133 [00:05<00:33,  3.49it/s]clinical_knowledge:  14%|█████████                                                          | 18/133 [00:05<00:32,  3.53it/s]clinical_knowledge:  14%|█████████▌                                                         | 19/133 [00:06<00:32,  3.56it/s]clinical_knowledge:  15%|██████████                                                         | 20/133 [00:06<00:31,  3.57it/s]clinical_knowledge:  16%|██████████▌                                                        | 21/133 [00:06<00:32,  3.49it/s]clinical_knowledge:  17%|███████████                                                        | 22/133 [00:07<00:32,  3.45it/s]clinical_knowledge:  17%|███████████▌                                                       | 23/133 [00:07<00:31,  3.47it/s]clinical_knowledge:  18%|████████████                                                       | 24/133 [00:07<00:30,  3.52it/s]clinical_knowledge:  19%|████████████▌                                                      | 25/133 [00:07<00:31,  3.46it/s]clinical_knowledge:  20%|█████████████                                                      | 26/133 [00:08<00:35,  2.99it/s]clinical_knowledge:  20%|█████████████▌                                                     | 27/133 [00:08<00:37,  2.80it/s]clinical_knowledge:  21%|██████████████                                                     | 28/133 [00:09<00:38,  2.76it/s]clinical_knowledge:  22%|██████████████▌                                                    | 29/133 [00:09<00:38,  2.72it/s]clinical_knowledge:  23%|███████████████                                                    | 30/133 [00:09<00:39,  2.60it/s]clinical_knowledge:  23%|███████████████▌                                                   | 31/133 [00:10<00:40,  2.51it/s]clinical_knowledge:  24%|████████████████                                                   | 32/133 [00:10<00:41,  2.44it/s]clinical_knowledge:  25%|████████████████▌                                                  | 33/133 [00:11<00:40,  2.46it/s]clinical_knowledge:  26%|█████████████████▏                                                 | 34/133 [00:11<00:40,  2.43it/s]clinical_knowledge:  26%|█████████████████▋                                                 | 35/133 [00:12<00:40,  2.44it/s]clinical_knowledge:  27%|██████████████████▏                                                | 36/133 [00:12<00:39,  2.44it/s]clinical_knowledge:  28%|██████████████████▋                                                | 37/133 [00:12<00:40,  2.39it/s]clinical_knowledge:  29%|███████████████████▏                                               | 38/133 [00:13<00:39,  2.41it/s]clinical_knowledge:  29%|███████████████████▋                                               | 39/133 [00:13<00:41,  2.28it/s]clinical_knowledge:  30%|████████████████████▏                                              | 40/133 [00:14<00:39,  2.37it/s]clinical_knowledge:  31%|████████████████████▋                                              | 41/133 [00:14<00:38,  2.38it/s]clinical_knowledge:  32%|█████████████████████▏                                             | 42/133 [00:15<00:37,  2.40it/s]clinical_knowledge:  32%|█████████████████████▋                                             | 43/133 [00:15<00:37,  2.37it/s]clinical_knowledge:  33%|██████████████████████▏                                            | 44/133 [00:15<00:36,  2.41it/s]clinical_knowledge:  34%|██████████████████████▋                                            | 45/133 [00:16<00:36,  2.42it/s]clinical_knowledge:  35%|███████████████████████▏                                           | 46/133 [00:16<00:37,  2.35it/s]clinical_knowledge:  35%|███████████████████████▋                                           | 47/133 [00:17<00:37,  2.29it/s]clinical_knowledge:  36%|████████████████████████▏                                          | 48/133 [00:17<00:36,  2.31it/s]clinical_knowledge:  37%|████████████████████████▋                                          | 49/133 [00:17<00:35,  2.36it/s]clinical_knowledge:  38%|█████████████████████████▏                                         | 50/133 [00:18<00:34,  2.40it/s]clinical_knowledge:  38%|█████████████████████████▋                                         | 51/133 [00:18<00:33,  2.46it/s]clinical_knowledge:  39%|██████████████████████████▏                                        | 52/133 [00:19<00:33,  2.44it/s]clinical_knowledge:  40%|██████████████████████████▋                                        | 53/133 [00:19<00:33,  2.42it/s]clinical_knowledge:  41%|███████████████████████████▏                                       | 54/133 [00:19<00:29,  2.69it/s]clinical_knowledge:  41%|███████████████████████████▋                                       | 55/133 [00:20<00:27,  2.86it/s]clinical_knowledge:  42%|████████████████████████████▏                                      | 56/133 [00:20<00:25,  3.00it/s]clinical_knowledge:  43%|████████████████████████████▋                                      | 57/133 [00:20<00:23,  3.17it/s]clinical_knowledge:  44%|█████████████████████████████▏                                     | 58/133 [00:21<00:22,  3.28it/s]clinical_knowledge:  44%|█████████████████████████████▋                                     | 59/133 [00:21<00:21,  3.39it/s]clinical_knowledge:  45%|██████████████████████████████▏                                    | 60/133 [00:21<00:21,  3.43it/s]clinical_knowledge:  46%|██████████████████████████████▋                                    | 61/133 [00:21<00:20,  3.53it/s]clinical_knowledge:  47%|███████████████████████████████▏                                   | 62/133 [00:22<00:19,  3.57it/s]clinical_knowledge:  47%|███████████████████████████████▋                                   | 63/133 [00:22<00:19,  3.56it/s]clinical_knowledge:  48%|████████████████████████████████▏                                  | 64/133 [00:22<00:19,  3.62it/s]clinical_knowledge:  49%|████████████████████████████████▋                                  | 65/133 [00:22<00:18,  3.67it/s]clinical_knowledge:  50%|█████████████████████████████████▏                                 | 66/133 [00:23<00:18,  3.59it/s]clinical_knowledge:  50%|█████████████████████████████████▊                                 | 67/133 [00:23<00:18,  3.62it/s]clinical_knowledge:  51%|██████████████████████████████████▎                                | 68/133 [00:23<00:18,  3.60it/s]clinical_knowledge:  52%|██████████████████████████████████▊                                | 69/133 [00:24<00:17,  3.58it/s]clinical_knowledge:  53%|███████████████████████████████████▎                               | 70/133 [00:24<00:17,  3.59it/s]clinical_knowledge:  53%|███████████████████████████████████▊                               | 71/133 [00:24<00:17,  3.59it/s]clinical_knowledge:  54%|████████████████████████████████████▎                              | 72/133 [00:24<00:16,  3.60it/s]clinical_knowledge:  55%|████████████████████████████████████▊                              | 73/133 [00:25<00:16,  3.61it/s]clinical_knowledge:  56%|█████████████████████████████████████▎                             | 74/133 [00:25<00:16,  3.59it/s]clinical_knowledge:  56%|█████████████████████████████████████▊                             | 75/133 [00:25<00:16,  3.59it/s]clinical_knowledge:  57%|██████████████████████████████████████▎                            | 76/133 [00:26<00:16,  3.54it/s]clinical_knowledge:  58%|██████████████████████████████████████▊                            | 77/133 [00:26<00:15,  3.58it/s]clinical_knowledge:  59%|███████████████████████████████████████▎                           | 78/133 [00:26<00:15,  3.57it/s]clinical_knowledge:  59%|███████████████████████████████████████▊                           | 79/133 [00:26<00:15,  3.57it/s]clinical_knowledge:  60%|████████████████████████████████████████▎                          | 80/133 [00:27<00:15,  3.35it/s]clinical_knowledge:  61%|████████████████████████████████████████▊                          | 81/133 [00:27<00:15,  3.42it/s]clinical_knowledge:  62%|█████████████████████████████████████████▎                         | 82/133 [00:27<00:14,  3.47it/s]clinical_knowledge:  62%|█████████████████████████████████████████▊                         | 83/133 [00:28<00:14,  3.49it/s]clinical_knowledge:  63%|██████████████████████████████████████████▎                        | 84/133 [00:28<00:14,  3.44it/s]clinical_knowledge:  64%|██████████████████████████████████████████▊                        | 85/133 [00:28<00:13,  3.47it/s]clinical_knowledge:  65%|███████████████████████████████████████████▎                       | 86/133 [00:28<00:13,  3.49it/s]clinical_knowledge:  65%|███████████████████████████████████████████▊                       | 87/133 [00:29<00:13,  3.47it/s]clinical_knowledge:  66%|████████████████████████████████████████████▎                      | 88/133 [00:29<00:12,  3.50it/s]clinical_knowledge:  67%|████████████████████████████████████████████▊                      | 89/133 [00:29<00:12,  3.47it/s]clinical_knowledge:  68%|█████████████████████████████████████████████▎                     | 90/133 [00:30<00:12,  3.53it/s]clinical_knowledge:  68%|█████████████████████████████████████████████▊                     | 91/133 [00:30<00:11,  3.54it/s]clinical_knowledge:  69%|██████████████████████████████████████████████▎                    | 92/133 [00:30<00:11,  3.62it/s]clinical_knowledge:  70%|██████████████████████████████████████████████▊                    | 93/133 [00:30<00:11,  3.62it/s]clinical_knowledge:  71%|███████████████████████████████████████████████▎                   | 94/133 [00:31<00:10,  3.61it/s]clinical_knowledge:  71%|███████████████████████████████████████████████▊                   | 95/133 [00:31<00:10,  3.60it/s]clinical_knowledge:  72%|████████████████████████████████████████████████▎                  | 96/133 [00:31<00:10,  3.43it/s]clinical_knowledge:  73%|████████████████████████████████████████████████▊                  | 97/133 [00:32<00:10,  3.48it/s]clinical_knowledge:  74%|█████████████████████████████████████████████████▎                 | 98/133 [00:32<00:09,  3.54it/s]clinical_knowledge:  74%|█████████████████████████████████████████████████▊                 | 99/133 [00:32<00:09,  3.54it/s]clinical_knowledge:  75%|█████████████████████████████████████████████████▌                | 100/133 [00:32<00:09,  3.50it/s]clinical_knowledge:  76%|██████████████████████████████████████████████████                | 101/133 [00:33<00:09,  3.52it/s]clinical_knowledge:  77%|██████████████████████████████████████████████████▌               | 102/133 [00:33<00:08,  3.53it/s]clinical_knowledge:  77%|███████████████████████████████████████████████████               | 103/133 [00:33<00:08,  3.54it/s]clinical_knowledge:  78%|███████████████████████████████████████████████████▌              | 104/133 [00:33<00:08,  3.58it/s]clinical_knowledge:  79%|████████████████████████████████████████████████████              | 105/133 [00:34<00:08,  3.46it/s]clinical_knowledge:  80%|████████████████████████████████████████████████████▌             | 106/133 [00:34<00:07,  3.52it/s]clinical_knowledge:  80%|█████████████████████████████████████████████████████             | 107/133 [00:34<00:07,  3.52it/s]clinical_knowledge:  81%|█████████████████████████████████████████████████████▌            | 108/133 [00:35<00:07,  3.49it/s]clinical_knowledge:  82%|██████████████████████████████████████████████████████            | 109/133 [00:35<00:06,  3.54it/s]clinical_knowledge:  83%|██████████████████████████████████████████████████████▌           | 110/133 [00:35<00:06,  3.50it/s]clinical_knowledge:  83%|███████████████████████████████████████████████████████           | 111/133 [00:35<00:06,  3.53it/s]clinical_knowledge:  84%|███████████████████████████████████████████████████████▌          | 112/133 [00:36<00:05,  3.53it/s]clinical_knowledge:  85%|████████████████████████████████████████████████████████          | 113/133 [00:36<00:05,  3.49it/s]clinical_knowledge:  86%|████████████████████████████████████████████████████████▌         | 114/133 [00:36<00:05,  3.53it/s]clinical_knowledge:  86%|█████████████████████████████████████████████████████████         | 115/133 [00:37<00:05,  3.56it/s]clinical_knowledge:  87%|█████████████████████████████████████████████████████████▌        | 116/133 [00:37<00:04,  3.59it/s]clinical_knowledge:  88%|██████████████████████████████████████████████████████████        | 117/133 [00:37<00:04,  3.60it/s]clinical_knowledge:  89%|██████████████████████████████████████████████████████████▌       | 118/133 [00:37<00:04,  3.55it/s]clinical_knowledge:  89%|███████████████████████████████████████████████████████████       | 119/133 [00:38<00:03,  3.62it/s]clinical_knowledge:  90%|███████████████████████████████████████████████████████████▌      | 120/133 [00:38<00:03,  3.64it/s]clinical_knowledge:  91%|████████████████████████████████████████████████████████████      | 121/133 [00:38<00:03,  3.62it/s]clinical_knowledge:  92%|████████████████████████████████████████████████████████████▌     | 122/133 [00:39<00:03,  3.60it/s]clinical_knowledge:  92%|█████████████████████████████████████████████████████████████     | 123/133 [00:39<00:02,  3.58it/s]clinical_knowledge:  93%|█████████████████████████████████████████████████████████████▌    | 124/133 [00:39<00:02,  3.53it/s]clinical_knowledge:  94%|██████████████████████████████████████████████████████████████    | 125/133 [00:39<00:02,  3.56it/s]clinical_knowledge:  95%|██████████████████████████████████████████████████████████████▌   | 126/133 [00:40<00:01,  3.56it/s]clinical_knowledge:  95%|███████████████████████████████████████████████████████████████   | 127/133 [00:40<00:01,  3.59it/s]clinical_knowledge:  96%|███████████████████████████████████████████████████████████████▌  | 128/133 [00:40<00:01,  3.59it/s]clinical_knowledge:  97%|████████████████████████████████████████████████████████████████  | 129/133 [00:41<00:01,  3.60it/s]clinical_knowledge:  98%|████████████████████████████████████████████████████████████████▌ | 130/133 [00:41<00:00,  3.54it/s]clinical_knowledge:  98%|█████████████████████████████████████████████████████████████████ | 131/133 [00:41<00:00,  3.57it/s]clinical_knowledge:  99%|█████████████████████████████████████████████████████████████████▌| 132/133 [00:41<00:00,  3.60it/s]clinical_knowledge: 100%|██████████████████████████████████████████████████████████████████| 133/133 [00:42<00:00,  3.69it/s]clinical_knowledge: 100%|██████████████████████████████████████████████████████████████████| 133/133 [00:42<00:00,  3.16it/s]
╭─────────────────────────────── Traceback (most recent call last) ────────────────────────────────╮
│ /home/yufei/arabic/LLM-eval-pipeline/eval.py:25 in <module>                                      │
│                                                                                                  │
│   22 │   │   │   │   │     setting=args.setting,                                                 │
│   23 │   │   │   │   │     n_shot=args.n_shot,                                                   │
│   24 │   │   │   │   │     accelerator=accelerator)                                              │
│ ❱ 25 │   Eval.evaluate()                                                                         │
│   26                                                                                             │
│   27                                                                                             │
│   28                                                                                             │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:219 in evaluate                │
│                                                                                                  │
│   216 │   def evaluate(self):                                                                    │
│   217 │   │   all_datasets = self.benchmark.get_datasets(self.setting, self.n_shot)              │
│   218 │   │   lens = self._count_examples(all_datasets)                                          │
│ ❱ 219 │   │   metrics = self._eval_datasets(all_datasets, save_responses=True)                   │
│   220 │   │   aggr_metrics = self._aggregate_metrics(metrics, lens)                              │
│   221 │   │   if self.accelerator.is_main_process:                                               │
│   222 │   │   │   self.save_aggr_metrics(aggr_metrics)                                           │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:211 in _eval_datasets          │
│                                                                                                  │
│   208 │   │   │   │   │   │   }                                                                  │
│   209 │   │   │   │   }                                                                          │
│   210 │   │   """                                                                                │
│ ❱ 211 │   │   return {                                                                           │
│   212 │   │   │   task_name: self._eval_task(task_name, all_datasets[task_name], save_response   │
│   213 │   │   │   for task_name in all_datasets.keys()                                           │
│   214 │   │   }                                                                                  │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:212 in <dictcomp>              │
│                                                                                                  │
│   209 │   │   │   │   }                                                                          │
│   210 │   │   """                                                                                │
│   211 │   │   return {                                                                           │
│ ❱ 212 │   │   │   task_name: self._eval_task(task_name, all_datasets[task_name], save_response   │
│   213 │   │   │   for task_name in all_datasets.keys()                                           │
│   214 │   │   }                                                                                  │
│   215                                                                                            │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:188 in _eval_task              │
│                                                                                                  │
│   185 │   │                                                                                      │
│   186 │   │   samples = self._zip_qra(dataset, response_list, response_answer_list)              │
│   187 │   │   if save_responses and self.accelerator.is_main_process:                            │
│ ❱ 188 │   │   │   self.save_response(samples, task_name)                                         │
│   189 │   │                                                                                      │
│   190 │   │   metrics = self._compute_metrics(samples, task_name)                                │
│   191 │   │   self.accelerator.print(metrics)                                                    │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:140 in save_response           │
│                                                                                                  │
│   137 │   │                                                                                      │
│   138 │   │   save_file = os.path.join(self.model_results_dir, f'{task_name}.jsonl')             │
│   139 │   │   os.makedirs(os.path.dirname(save_file), exist_ok=True)                             │
│ ❱ 140 │   │   with open(save_file, 'w', encoding='utf-8') as f:                                  │
│   141 │   │   │   f.writelines([json.dumps(sample, ensure_ascii=False) + '\n'  for sample in s   │
│   142 │   │   print(f'Save responses to {save_file}')                                            │
│   143                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────╯
PermissionError: [Errno 13] Permission denied: 
'benchmark_eval/results/zero_shot/MMLUArabic/llama-2-7b-hf/clinical_knowledge.jsonl'
╭─────────────────────────────── Traceback (most recent call last) ────────────────────────────────╮
│ /mntcephfs/data/med/miniconda3/envs/steven/bin/accelerate:8 in <module>                          │
│                                                                                                  │
│   5 from accelerate.commands.accelerate_cli import main                                          │
│   6 if __name__ == '__main__':                                                                   │
│   7 │   sys.argv[0] = re.sub(r'(-script\.pyw|\.exe)?$', '', sys.argv[0])                         │
│ ❱ 8 │   sys.exit(main())                                                                         │
│   9                                                                                              │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/accelerate_cli.py:45 in main  │
│                                                                                                  │
│   42 │   │   exit(1)                                                                             │
│   43 │                                                                                           │
│   44 │   # Run                                                                                   │
│ ❱ 45 │   args.func(args)                                                                         │
│   46                                                                                             │
│   47                                                                                             │
│   48 if __name__ == "__main__":                                                                  │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/launch.py:918 in              │
│ launch_command                                                                                   │
│                                                                                                  │
│   915 │   elif defaults is not None and defaults.compute_environment == ComputeEnvironment.AMA   │
│   916 │   │   sagemaker_launcher(defaults, args)                                                 │
│   917 │   else:                                                                                  │
│ ❱ 918 │   │   simple_launcher(args)                                                              │
│   919                                                                                            │
│   920                                                                                            │
│   921 def main():                                                                                │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/launch.py:580 in              │
│ simple_launcher                                                                                  │
│                                                                                                  │
│   577 │   process.wait()                                                                         │
│   578 │   if process.returncode != 0:                                                            │
│   579 │   │   if not args.quiet:                                                                 │
│ ❱ 580 │   │   │   raise subprocess.CalledProcessError(returncode=process.returncode, cmd=cmd)    │
│   581 │   │   else:                                                                              │
│   582 │   │   │   sys.exit(1)                                                                    │
│   583                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────╯
CalledProcessError: Command '['/mntcephfs/data/med/miniconda3/envs/steven/bin/python', 'eval.py', '--model_id', 
'llama-2-7b-hf', '--batch_size', '2', '--benchmark_name', 'MMLUArabic', '--setting', 'zero_shot', '--generation_type', 
'MMLU']' returned non-zero exit status 1.
[01:57:05] WARNING  The following values were not passed to `accelerate launch` and had defaults used instead:   launch.py:890
                            `--num_processes` was set to a value of `1`                                                       
                            `--num_machines` was set to a value of `1`                                                        
                            `--mixed_precision` was set to a value of `'no'`                                                  
                            `--dynamo_backend` was set to a value of `'no'`                                                   
                    To avoid this warning pass in values for each of the problematic parameters or run                        
                    `accelerate config`.                                                                                      
clinical_knowledge:   0%|                                                                            | 0/133 [00:00<?, ?it/s]You're using a BloomTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
clinical_knowledge:   1%|▌                                                                   | 1/133 [00:00<01:41,  1.30it/s]clinical_knowledge:   3%|██                                                                  | 4/133 [00:00<00:23,  5.60it/s]clinical_knowledge:   5%|███                                                                 | 6/133 [00:00<00:15,  8.14it/s]clinical_knowledge:   7%|████▌                                                               | 9/133 [00:01<00:10, 11.81it/s]clinical_knowledge:   9%|██████                                                             | 12/133 [00:01<00:08, 14.94it/s]clinical_knowledge:  11%|███████▌                                                           | 15/133 [00:01<00:06, 17.74it/s]clinical_knowledge:  14%|█████████                                                          | 18/133 [00:01<00:05, 19.75it/s]clinical_knowledge:  16%|██████████▌                                                        | 21/133 [00:01<00:05, 21.28it/s]clinical_knowledge:  18%|████████████                                                       | 24/133 [00:01<00:04, 22.54it/s]clinical_knowledge:  20%|█████████████▌                                                     | 27/133 [00:01<00:04, 23.61it/s]clinical_knowledge:  23%|███████████████                                                    | 30/133 [00:01<00:04, 24.28it/s]clinical_knowledge:  25%|████████████████▌                                                  | 33/133 [00:02<00:04, 24.71it/s]clinical_knowledge:  27%|██████████████████▏                                                | 36/133 [00:02<00:03, 25.19it/s]clinical_knowledge:  29%|███████████████████▋                                               | 39/133 [00:02<00:03, 24.92it/s]clinical_knowledge:  32%|█████████████████████▏                                             | 42/133 [00:02<00:03, 25.27it/s]clinical_knowledge:  34%|██████████████████████▋                                            | 45/133 [00:02<00:03, 25.53it/s]clinical_knowledge:  36%|████████████████████████▏                                          | 48/133 [00:02<00:03, 25.52it/s]clinical_knowledge:  38%|█████████████████████████▋                                         | 51/133 [00:02<00:03, 24.37it/s]clinical_knowledge:  41%|███████████████████████████▏                                       | 54/133 [00:02<00:03, 25.02it/s]clinical_knowledge:  43%|████████████████████████████▋                                      | 57/133 [00:03<00:03, 24.85it/s]clinical_knowledge:  45%|██████████████████████████████▏                                    | 60/133 [00:03<00:02, 25.22it/s]clinical_knowledge:  47%|███████████████████████████████▋                                   | 63/133 [00:03<00:02, 25.60it/s]clinical_knowledge:  50%|█████████████████████████████████▏                                 | 66/133 [00:03<00:02, 25.80it/s]clinical_knowledge:  52%|██████████████████████████████████▊                                | 69/133 [00:03<00:02, 25.56it/s]clinical_knowledge:  54%|████████████████████████████████████▎                              | 72/133 [00:03<00:02, 25.58it/s]clinical_knowledge:  56%|█████████████████████████████████████▊                             | 75/133 [00:03<00:02, 25.71it/s]clinical_knowledge:  59%|███████████████████████████████████████▎                           | 78/133 [00:03<00:02, 25.69it/s]clinical_knowledge:  61%|████████████████████████████████████████▊                          | 81/133 [00:03<00:02, 24.70it/s]clinical_knowledge:  63%|██████████████████████████████████████████▎                        | 84/133 [00:04<00:01, 24.71it/s]clinical_knowledge:  65%|███████████████████████████████████████████▊                       | 87/133 [00:04<00:01, 24.59it/s]clinical_knowledge:  68%|█████████████████████████████████████████████▎                     | 90/133 [00:04<00:01, 24.69it/s]clinical_knowledge:  70%|██████████████████████████████████████████████▊                    | 93/133 [00:04<00:01, 25.42it/s]clinical_knowledge:  72%|████████████████████████████████████████████████▎                  | 96/133 [00:04<00:01, 24.95it/s]clinical_knowledge:  74%|█████████████████████████████████████████████████▊                 | 99/133 [00:04<00:01, 25.23it/s]clinical_knowledge:  77%|██████████████████████████████████████████████████▌               | 102/133 [00:04<00:01, 25.30it/s]clinical_knowledge:  79%|████████████████████████████████████████████████████              | 105/133 [00:04<00:01, 25.15it/s]clinical_knowledge:  81%|█████████████████████████████████████████████████████▌            | 108/133 [00:05<00:00, 25.30it/s]clinical_knowledge:  83%|███████████████████████████████████████████████████████           | 111/133 [00:05<00:00, 25.41it/s]clinical_knowledge:  86%|████████████████████████████████████████████████████████▌         | 114/133 [00:05<00:00, 25.43it/s]clinical_knowledge:  88%|██████████████████████████████████████████████████████████        | 117/133 [00:05<00:00, 25.68it/s]clinical_knowledge:  90%|███████████████████████████████████████████████████████████▌      | 120/133 [00:05<00:00, 25.85it/s]clinical_knowledge:  92%|█████████████████████████████████████████████████████████████     | 123/133 [00:05<00:00, 25.60it/s]clinical_knowledge:  95%|██████████████████████████████████████████████████████████████▌   | 126/133 [00:05<00:00, 25.58it/s]clinical_knowledge:  97%|████████████████████████████████████████████████████████████████  | 129/133 [00:05<00:00, 25.65it/s]clinical_knowledge:  99%|█████████████████████████████████████████████████████████████████▌| 132/133 [00:05<00:00, 25.63it/s]clinical_knowledge: 100%|██████████████████████████████████████████████████████████████████| 133/133 [00:06<00:00, 22.16it/s]
╭─────────────────────────────── Traceback (most recent call last) ────────────────────────────────╮
│ /home/yufei/arabic/LLM-eval-pipeline/eval.py:25 in <module>                                      │
│                                                                                                  │
│   22 │   │   │   │   │     setting=args.setting,                                                 │
│   23 │   │   │   │   │     n_shot=args.n_shot,                                                   │
│   24 │   │   │   │   │     accelerator=accelerator)                                              │
│ ❱ 25 │   Eval.evaluate()                                                                         │
│   26                                                                                             │
│   27                                                                                             │
│   28                                                                                             │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:219 in evaluate                │
│                                                                                                  │
│   216 │   def evaluate(self):                                                                    │
│   217 │   │   all_datasets = self.benchmark.get_datasets(self.setting, self.n_shot)              │
│   218 │   │   lens = self._count_examples(all_datasets)                                          │
│ ❱ 219 │   │   metrics = self._eval_datasets(all_datasets, save_responses=True)                   │
│   220 │   │   aggr_metrics = self._aggregate_metrics(metrics, lens)                              │
│   221 │   │   if self.accelerator.is_main_process:                                               │
│   222 │   │   │   self.save_aggr_metrics(aggr_metrics)                                           │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:211 in _eval_datasets          │
│                                                                                                  │
│   208 │   │   │   │   │   │   }                                                                  │
│   209 │   │   │   │   }                                                                          │
│   210 │   │   """                                                                                │
│ ❱ 211 │   │   return {                                                                           │
│   212 │   │   │   task_name: self._eval_task(task_name, all_datasets[task_name], save_response   │
│   213 │   │   │   for task_name in all_datasets.keys()                                           │
│   214 │   │   }                                                                                  │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:212 in <dictcomp>              │
│                                                                                                  │
│   209 │   │   │   │   }                                                                          │
│   210 │   │   """                                                                                │
│   211 │   │   return {                                                                           │
│ ❱ 212 │   │   │   task_name: self._eval_task(task_name, all_datasets[task_name], save_response   │
│   213 │   │   │   for task_name in all_datasets.keys()                                           │
│   214 │   │   }                                                                                  │
│   215                                                                                            │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:188 in _eval_task              │
│                                                                                                  │
│   185 │   │                                                                                      │
│   186 │   │   samples = self._zip_qra(dataset, response_list, response_answer_list)              │
│   187 │   │   if save_responses and self.accelerator.is_main_process:                            │
│ ❱ 188 │   │   │   self.save_response(samples, task_name)                                         │
│   189 │   │                                                                                      │
│   190 │   │   metrics = self._compute_metrics(samples, task_name)                                │
│   191 │   │   self.accelerator.print(metrics)                                                    │
│                                                                                                  │
│ /home/yufei/arabic/LLM-eval-pipeline/benchmark_eval/evaluation.py:139 in save_response           │
│                                                                                                  │
│   136 │   │   assert isinstance(task_name, str) and (isinstance(samples, list) and isinstance(   │
│   137 │   │                                                                                      │
│   138 │   │   save_file = os.path.join(self.model_results_dir, f'{task_name}.jsonl')             │
│ ❱ 139 │   │   os.makedirs(os.path.dirname(save_file), exist_ok=True)                             │
│   140 │   │   with open(save_file, 'w', encoding='utf-8') as f:                                  │
│   141 │   │   │   f.writelines([json.dumps(sample, ensure_ascii=False) + '\n'  for sample in s   │
│   142 │   │   print(f'Save responses to {save_file}')                                            │
│                                                                                                  │
│ /mntcephfs/data/med/miniconda3/envs/steven/lib/python3.9/os.py:225 in makedirs                   │
│                                                                                                  │
│    222 │   │   if tail == cdir:           # xxx/newdir/. exists if xxx/newdir exists             │
│    223 │   │   │   return                                                                        │
│    224 │   try:                                                                                  │
│ ❱  225 │   │   mkdir(name, mode)                                                                 │
│    226 │   except OSError:                                                                       │
│    227 │   │   # Cannot rely on checking for EEXIST, since the operating system                  │
│    228 │   │   # could give priority to other errors like EACCES or EROFS                        │
╰──────────────────────────────────────────────────────────────────────────────────────────────────╯
PermissionError: [Errno 13] Permission denied: 'benchmark_eval/results/zero_shot/MMLUArabic/bloomz-7b1-mt'
╭─────────────────────────────── Traceback (most recent call last) ────────────────────────────────╮
│ /mntcephfs/data/med/miniconda3/envs/steven/bin/accelerate:8 in <module>                          │
│                                                                                                  │
│   5 from accelerate.commands.accelerate_cli import main                                          │
│   6 if __name__ == '__main__':                                                                   │
│   7 │   sys.argv[0] = re.sub(r'(-script\.pyw|\.exe)?$', '', sys.argv[0])                         │
│ ❱ 8 │   sys.exit(main())                                                                         │
│   9                                                                                              │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/accelerate_cli.py:45 in main  │
│                                                                                                  │
│   42 │   │   exit(1)                                                                             │
│   43 │                                                                                           │
│   44 │   # Run                                                                                   │
│ ❱ 45 │   args.func(args)                                                                         │
│   46                                                                                             │
│   47                                                                                             │
│   48 if __name__ == "__main__":                                                                  │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/launch.py:918 in              │
│ launch_command                                                                                   │
│                                                                                                  │
│   915 │   elif defaults is not None and defaults.compute_environment == ComputeEnvironment.AMA   │
│   916 │   │   sagemaker_launcher(defaults, args)                                                 │
│   917 │   else:                                                                                  │
│ ❱ 918 │   │   simple_launcher(args)                                                              │
│   919                                                                                            │
│   920                                                                                            │
│   921 def main():                                                                                │
│                                                                                                  │
│ /home/yufei/.local/lib/python3.9/site-packages/accelerate/commands/launch.py:580 in              │
│ simple_launcher                                                                                  │
│                                                                                                  │
│   577 │   process.wait()                                                                         │
│   578 │   if process.returncode != 0:                                                            │
│   579 │   │   if not args.quiet:                                                                 │
│ ❱ 580 │   │   │   raise subprocess.CalledProcessError(returncode=process.returncode, cmd=cmd)    │
│   581 │   │   else:                                                                              │
│   582 │   │   │   sys.exit(1)                                                                    │
│   583                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────╯
CalledProcessError: Command '['/mntcephfs/data/med/miniconda3/envs/steven/bin/python', 'eval.py', '--model_id', 
'bloomz-7b1-mt', '--batch_size', '2', '--benchmark_name', 'MMLUArabic', '--setting', 'zero_shot', '--generation_type', 
'MMLU']' returned non-zero exit status 1.
